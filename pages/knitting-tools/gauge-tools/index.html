<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="편물 게이지를 다양한 단위로 변환하고 계산합니다">
  <title>게이지 변환 계산기 - Simple Utility Web</title>

  <!-- CSS -->
  <link rel="preload" href="../../../css/main.css" as="style">
  <link rel="preload" href="../../../css/components.css" as="style">
  <link rel="stylesheet" href="../../../css/main.css">
  <link rel="stylesheet" href="../../../css/components.css">
  <link rel="stylesheet" href="../../../css/theme.css">
  <link rel="stylesheet" href="../../../css/knitting-tools/gauge-tools/gauge-converter.css">
</head>
<body>
  <!-- Navigation (will be injected) -->
  <div id="nav-container"></div>

  <!-- Main Content -->
  <main id="main-content" role="main">
    <article class="gauge-converter tool-container">
      <h1>게이지 변환 계산기</h1>

      <p class="intro-text">
        편물의 기준 게이지와 실제 게이지를 입력하여 필요한 코수와 단수를 계산합니다.
      </p>

      <div id="error-container" role="alert" aria-live="assertive"></div>

      <!-- 측정 기준 단위 선택 -->
      <section class="gauge-section">
        <h2>측정 기준</h2>
        <p class="text-light">게이지 측정에 사용한 기준 크기를 선택하세요</p>

        <fieldset class="unit-selection">
          <legend class="sr-only">측정 기준 단위</legend>
          <div class="radio-group">
            <label class="radio-label">
              <input
                type="radio"
                name="gauge-unit"
                value="10cm"
                id="unit-10cm"
                checked
                aria-label="10cm 기준"
              />
              <span>10cm x 10cm 기준</span>
            </label>

            <label class="radio-label">
              <input
                type="radio"
                name="gauge-unit"
                value="4inch"
                id="unit-4inch"
                aria-label="4 inch 기준"
              />
              <span>4 inch x 4 inch 기준</span>
            </label>
          </div>
        </fieldset>
      </section>

      <!-- 기준 게이지 -->
      <section class="gauge-section">
        <h2>기준 게이지</h2>
        <p class="text-light">도안이나 패턴에서 제시하는 게이지를 입력하세요</p>

        <div class="gauge-input-group">
          <div class="input-wrapper">
            <label for="base-stitches">코수 (10cm 기준)</label>
            <input
              type="number"
              id="base-stitches"
              placeholder="예: 25"
              min="1"
              max="1000"
              aria-label="기준 게이지 코수"
            />
          </div>

          <div class="input-wrapper">
            <label for="base-rows">단수 (10cm 기준)</label>
            <input
              type="number"
              id="base-rows"
              placeholder="예: 30"
              min="1"
              max="1000"
              aria-label="기준 게이지 단수"
            />
          </div>
        </div>
      </section>

      <!-- 실제 게이지 -->
      <section class="gauge-section">
        <h2>실제 게이지</h2>
        <p class="text-light">실제로 뜬 게이지를 입력하세요</p>

        <div class="gauge-input-group">
          <div class="input-wrapper">
            <label for="actual-stitches">코수 (10cm 기준)</label>
            <input
              type="number"
              id="actual-stitches"
              placeholder="예: 20"
              min="1"
              max="1000"
              aria-label="실제 게이지 코수"
            />
          </div>

          <div class="input-wrapper">
            <label for="actual-rows">단수 (10cm 기준)</label>
            <input
              type="number"
              id="actual-rows"
              placeholder="예: 25"
              min="1"
              max="1000"
              aria-label="실제 게이지 단수"
            />
          </div>
        </div>
      </section>

      <!-- 변환할 값 -->
      <section class="gauge-section">
        <h2>변환할 값</h2>
        <p class="text-light">도안의 코수나 단수를 입력하세요 (둘 다 입력 가능)</p>

        <div class="gauge-input-group">
          <div class="input-wrapper">
            <label for="input-stitches">코수 (선택)</label>
            <input
              type="number"
              id="input-stitches"
              placeholder="예: 100"
              min="0"
              max="10000"
              aria-label="변환할 코수"
            />
          </div>

          <div class="input-wrapper">
            <label for="input-rows">단수 (선택)</label>
            <input
              type="number"
              id="input-rows"
              placeholder="예: 120"
              min="0"
              max="10000"
              aria-label="변환할 단수"
            />
          </div>
        </div>
      </section>

      <!-- 계산 버튼 -->
      <button id="calculate" class="calculate-button" aria-label="게이지 변환 계산하기">
        계산하기
      </button>

      <!-- 결과 -->
      <section id="result" class="result-section" style="display: none;">
        <h2>변환 결과</h2>

        <div class="result-display">
          <div class="result-item">
            <span class="result-label">변환된 코수:</span>
            <span id="result-stitches" class="result-value" aria-live="polite"></span>
          </div>

          <div class="result-item">
            <span class="result-label">변환된 단수:</span>
            <span id="result-rows" class="result-value" aria-live="polite"></span>
          </div>
        </div>
      </section>
    </article>
  </main>

  <!-- Footer (will be injected) -->
  <div id="footer-container"></div>

  <!-- Component Loading Scripts -->
  <script type="module">
    import { renderNavigation, initMobileMenu } from '../../../js/components/nav.js';
    import { renderFooter } from '../../../js/components/footer.js';
    import { showError } from '../../../js/components/error.js';

    // Load navigation
    async function loadNav() {
      try {
        const navHtml = await renderNavigation('gauge-converter');
        document.getElementById('nav-container').innerHTML = navHtml;
        initMobileMenu();
      } catch (error) {
        console.error('Navigation load failed:', error);
        showError({
          type: 'error',
          message: '네비게이션을 불러올 수 없습니다.'
        });
      }
    }

    // Load footer
    function loadFooter() {
      try {
        const footerHtml = renderFooter();
        document.getElementById('footer-container').innerHTML = footerHtml;
      } catch (error) {
        console.error('Footer load failed:', error);
      }
    }

    // Initialize page
    loadNav();
    loadFooter();
  </script>

  <!-- Gauge Converter Logic -->
  <script type="module">
    import { calculate, handleUnitChange, restoreInput, updateLabels, setCurrentUnit } from '../../../js/knitting-tools/gauge-tools/gauge-converter.js';

    // localStorage에서 이전 입력값 복원
    const savedInput = restoreInput();
    if (savedInput) {
      document.getElementById('base-stitches').value = savedInput.baseStitches;
      document.getElementById('base-rows').value = savedInput.baseRows;
      document.getElementById('actual-stitches').value = savedInput.actualStitches;
      document.getElementById('actual-rows').value = savedInput.actualRows;
      document.getElementById('input-stitches').value = savedInput.inputStitches;
      document.getElementById('input-rows').value = savedInput.inputRows;

      // 저장된 측정 단위 복원
      const unitRadio = document.getElementById(savedInput.unit === '4inch' ? 'unit-4inch' : 'unit-10cm');
      if (unitRadio) {
        unitRadio.checked = true;
        // currentUnit 업데이트
        setCurrentUnit(savedInput.unit);
        // 레이블 업데이트
        updateLabels(savedInput.unit);
      }
    }

    // 계산 버튼 클릭 이벤트
    const calculateButton = document.getElementById('calculate');
    if (calculateButton) {
      calculateButton.addEventListener('click', calculate);
    }

    // 측정 단위 변경 이벤트
    const unitRadios = document.querySelectorAll('input[name="gauge-unit"]');
    unitRadios.forEach((radio) => {
      radio.addEventListener('change', handleUnitChange);
    });

    // Enter 키로 계산
    const inputs = document.querySelectorAll('input[type="number"]');
    inputs.forEach((input) => {
      input.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          calculate();
        }
      });
    });
  </script>
</body>
</html>
